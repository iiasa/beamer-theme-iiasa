% Define templates

% Background
\defbeamertemplate{background}{iiasa text}{%
  \begin{tikzpicture}[
    overlay,
    remember picture,
    every node/.style={inner sep=0mm}
    ]
    % background
    \node [anchor=north west]
      at (current page.north west)
      {\includegraphics[width=\paperwidth, height=\paperheight]{background_purple_stripe.pdf}
      };
    % logo
    \node [anchor=north]
      at ($(current page.south east) + (-20mm, 6.5mm)$)
      {\includegraphics[height=5mm]{logo_white.eps}};
  \end{tikzpicture}
}

\defbeamertemplate{background}{iiasa section}{%
  \begin{tikzpicture}[
    overlay,
    remember picture,
    every node/.style={inner sep=0mm}
    ]
    % logo
    \node [anchor=north east]
      at ($(current page.north east) + (-4mm, -2mm)$)
      {\includegraphics[height=9mm]{logo-short_white.eps}};
  \end{tikzpicture}
}

% TODO
% The idea here is to have slide 7 from the pptx template available as well
% So one could call \setbeamertemplate{background}[iiasa image] before such 
% a frame and afterwards
% Calling it 'image' because this is what I envision as the main use case
% Still need to remove framenumber and logo from such pages (and possibly 
% set font color to white)
\defbeamertemplate{background}{iiasa image}{%
  \begin{tikzpicture}[
    overlay,
    remember picture,
    every node/.style={inner sep=0mm}
    ]
    % background
    \node [anchor=north west]
      at (current page.north west)
      {\includegraphics[width=\paperwidth, height=\paperheight]{background_all_purple.pdf}
      };
    % logo
    \node [anchor=north]
      at ($(current page.south east) + (-20mm, 6.5mm)$)
      {\includegraphics[height=5mm]{logo_white.eps}};
  \end{tikzpicture}
}

% Footline: display the frame number
\defbeamertemplate{footline}{iiasa}{%
  \begin{tikzpicture}[overlay, remember picture]
    \node [anchor = north east, inner sep = 2mm] at ($(current page.south west) +(16mm, 6.5mm)$)
      {\usebeamertemplate*{frame numbering}};
  \end{tikzpicture}
}

% Frame numbering: show totals
\defbeamertemplate{frame numbering}{iiasa}{
  \textbf{\insertframenumber}/\insertpresentationendframe
  }

% Frame title: beamer default, modified to set opacity (two lines marked <--)
% TODO limit the width of the title box (i.e. don't overlap the upper-right
%      swoosh if the contents text is actually short)
\defbeamertemplate*{frametitle}{iiasa transparent}[1][left]{%
  \ifbeamercolorempty[bg]{frametitle}{}{\nointerlineskip}%
  \@tempdima=\textwidth%
  \advance\@tempdima by\beamer@leftmargin%
  \advance\@tempdima by\beamer@rightmargin%
  \pgfsetfillopacity{0.5}% <--
  \begin{beamercolorbox}[sep=0.3cm,#1,wd=\the\@tempdima]{frametitle}
    \pgfsetfillopacity{1}% <--
    \usebeamerfont{frametitle}%
    \vbox{}\vskip-1ex%
    \if@tempswa\else\csname beamer@fte#1\endcsname\fi%
    \strut\insertframetitle\strut\par%
    {%
      \ifx\insertframesubtitle\@empty%
      \else%
      {\usebeamerfont{framesubtitle}\usebeamercolor[fg]{framesubtitle}\insertframesubtitle\strut\par}%
      \fi
    }%
    \vskip-1ex%
    \if@tempswa\else\vskip-.3cm\fi% set inside beamercolorbox... evil here...
  \end{beamercolorbox}%
}

% Navigation symbols: clear
\defbeamertemplate{navigation symbols}{iiasa}{}

% \insertpresentationendframe
% see: https://tex.stackexchange.com/a/50090/94986
\def\insertpresentationendframe{\inserttotalframenumber}
\g@addto@macro{\appendix}{%
\immediate\write\@auxout{\string\@writefile{nav}{\noexpand\headcommand{\noexpand\def\noexpand\insertpresentationendframe{\the\c@framenumber}}}}
}

% Set templates
\setbeamertemplate{background}[iiasa text]
\setbeamertemplate{footline}[iiasa]
\setbeamertemplate{frame numbering}[iiasa]
\setbeamertemplate{navigation symbols}[iiasa]
